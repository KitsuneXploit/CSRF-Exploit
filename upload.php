<?php
// Initialize variables
$urlsFile = '';
$filename = '';
$filedata = '';

// Parse command line arguments
$options = getopt("u:n:f:");

// Check if required arguments are provided
if (!isset($options['u']) || !isset($options['n']) || !isset($options['f'])) {
    echo "Usage: php upload.php -u list_urls.txt -n filename -f filedata\n";
    exit(1);
}

// Get values from command line arguments
$urlsFile = $options['u'];
$filename = $options['n'];
$filedata = $options['f'];

// Read endpoint URLs from list_urls.txt
$urls = file($urlsFile, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

foreach ($urls as $url) {
    // Initialize cURL session
    $curl = curl_init();

    // Set cURL options
    curl_setopt($curl, CURLOPT_URL, $url);
    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($curl, CURLOPT_POST, true);
    curl_setopt($curl, CURLOPT_POSTFIELDS, array($filename => '@' . realpath($filedata)));

    // Execute cURL session
    $response = curl_exec($curl);

    // Close cURL session
    curl_close($curl);

    // Print response
    echo "Uploaded to $url: $response\n";
}
?>
